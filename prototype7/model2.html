<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Swipe Card App</title>
<style>
  body {
    margin: 0;
    padding: 0;
    background: #222;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    color: white;
  }
  #cardArea {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 40px;
  }
  .card {
    width: 160px;
    height: 220px;
    background: #444;
    border-radius: 15px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 26px;
    user-select: none;
    position: relative;
  }
  .card-type { font-size: 28px; }
  .type-analysis { background: #ff6347; }
  .type-idea { background: #1e90ff; }
  .type-image { background: #22aa55; }

  #buttons { margin-bottom: 40px; }
  button {
    font-size: 24px;
    padding: 10px 20px;
    margin: 0 15px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
  }
</style>
</head>
<body>
<div id="cardArea"></div>

<div id="buttons">
  <button id="leftBtn">←</button>
  <button id="rightBtn">→</button>
</div>

<script>
let globalCount = 0;
let deck = [ { type: "image", label: "画像" } ];

// 中心カードのインデックス
let centerIndex = 0;
const cardArea = document.getElementById("cardArea");

function getVisibleCards() {
  let visible = [];
  for (let d = -3; d <= 3; d++) {
    let idx = centerIndex + d;
    if (idx >= 0 && idx < deck.length) visible.push(idx);
  }
  return visible;
}

function render() {
  cardArea.innerHTML = "";
  let indices = getVisibleCards();

  indices.forEach((i) => {
    const c = deck[i];
    const div = document.createElement("div");
    div.className = `card type-${c.type}`;
    div.innerHTML = `<div class='card-type'>${c.label}</div>`;

    let startX = 0;
    div.addEventListener("mousedown", e => startX = e.clientX);
    div.addEventListener("mouseup", e => handleSwipe(e.clientX - startX, i));
    div.addEventListener("touchstart", e => startX = e.touches[0].clientX);
    div.addEventListener("touchend", e => handleSwipe(e.changedTouches[0].clientX - startX, i));

    cardArea.appendChild(div);
  });
}

function handleSwipe(dist, realIndex) {
  if (Math.abs(dist) < 40) return;

  let newType = dist > 0 ? "idea" : "analysis";
  globalCount++;

  let newCard = {
    type: newType,
    label: `${newType === "idea" ? "発想" : "解析"}(${globalCount})`
  };

  deck.splice(realIndex + 1, 0, newCard);
  centerIndex = realIndex + 1;
  render();
}

leftBtn.onclick = () => {
  if (centerIndex > 0) centerIndex--;
  render();
};

rightBtn.onclick = () => {
  if (centerIndex < deck.length - 1) centerIndex++;
  render();
};

render();
</script>
</body>
</html>
