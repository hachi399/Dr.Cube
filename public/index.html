<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Camera Analyzer</title>
</head>
<body>
  <h2>ğŸ“¸ ã‚«ãƒ¡ãƒ©ã§æ’®å½±ã—ã¦GPT-4oã«é€ä¿¡</h2>
  <video id="video" autoplay playsinline></video>
  <button id="capture">æ’®å½±ï¼†åˆ†æ</button>
  <p id="result"></p>

  <script>
    const video = document.getElementById("video");
    const result = document.getElementById("result");

    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => video.srcObject = stream)
      .catch(err => alert("ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã§ãã¾ã›ã‚“ã§ã—ãŸ: " + err));

    document.getElementById("capture").onclick = async () => {
      const canvas = document.createElement("canvas");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext("2d").drawImage(video, 0, 0);
      const imageBase64 = canvas.toDataURL("image/jpeg").split(",")[1];

      result.textContent = "åˆ†æä¸­...";
      const res = await fetch("/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ imageBase64 })
      });

      const data = await res.json();
      result.textContent = data.output_text || JSON.stringify(data);
    };
  </script>
</body>
</html>
